var openFB=function(){function init(params){if(!params.appId)throw"appId parameter not set in init()";fbAppId=params.appId,params.tokenStore&&(tokenStore=params.tokenStore)}function getLoginStatus(callback){var token=tokenStore.fbtoken,loginStatus={};token?(loginStatus.status="connected",loginStatus.authResponse={token:token}):loginStatus.status="unknown",callback&&callback(loginStatus)}function login(callback,options){function loginWindow_loadStartHandler(event){var url=event.url;if(url.indexOf("access_token=")>0||url.indexOf("error=")>0){var timeout=600-((new Date).getTime()-startTime);setTimeout(function(){loginWindow.close()},timeout>0?timeout:0),oauthCallback(url)}}function loginWindow_exitHandler(){console.log("exit and remove listeners"),deferredLogin.reject({error:"user_cancelled",error_description:"User cancelled login process",error_reason:"user_cancelled"}),loginWindow.removeEventListener("loadstop",loginWindow_loadStartHandler),loginWindow.removeEventListener("exit",loginWindow_exitHandler),loginWindow=null,console.log("done removing listeners")}var loginWindow,startTime,scope="";return fbAppId?(options&&options.scope&&(scope=options.scope),loginCallback=callback,loginProcessed=!1,oauthRedirectURL="https://www.facebook.com/connect/login_success.html",startTime=(new Date).getTime(),loginWindow=window.open(FB_LOGIN_URL+"?client_id="+fbAppId+"&redirect_uri="+oauthRedirectURL+"&response_type=token&scope="+scope,"_blank","location=no"),void(runningInCordova&&(loginWindow.addEventListener("loadstart",loginWindow_loadStartHandler),loginWindow.addEventListener("exit",loginWindow_exitHandler)))):callback({status:"unknown",error:"Facebook App Id not set."})}function oauthCallback(url){var queryString,obj;loginProcessed=!0,url.indexOf("access_token=")>0?(queryString=url.substr(url.indexOf("#")+1),obj=parseQueryString(queryString),tokenStore.fbtoken=obj.access_token,loginCallback&&loginCallback({status:"connected",authResponse:{token:obj.access_token}})):url.indexOf("error=")>0?(queryString=url.substring(url.indexOf("?")+1,url.indexOf("#")),obj=parseQueryString(queryString),loginCallback&&loginCallback({status:"not_authorized",error:obj.error})):loginCallback&&loginCallback({status:"not_authorized"})}function logout(callback){var logoutWindow,token=tokenStore.fbtoken;tokenStore.removeItem("fbtoken"),token&&(logoutWindow=window.open(FB_LOGOUT_URL+"?access_token="+token+"&next="+logoutRedirectURL,"_blank","location=no"),setTimeout(function(){logoutWindow.close()},700)),callback&&callback()}function api(obj){var url,method=obj.method||"GET",params=obj.params||{},xhr=new XMLHttpRequest;params.access_token=tokenStore.fbtoken,url="https://graph.facebook.com"+obj.path+"?"+toQueryString(params),xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status)obj.success&&obj.success(JSON.parse(xhr.responseText));else{var error=xhr.responseText?JSON.parse(xhr.responseText).error:{message:"An error has occurred"};obj.error&&obj.error(error)}},xhr.open(method,url,!0),xhr.send()}function revokePermissions(success,error){return api({method:"DELETE",path:"/me/permissions",success:function(){tokenStore.fbtoken=void 0,success()},error:error})}function parseQueryString(queryString){var qs=decodeURIComponent(queryString),obj={},params=qs.split("&");return params.forEach(function(param){var splitter=param.split("=");obj[splitter[0]]=splitter[1]}),obj}function toQueryString(obj){var parts=[];for(var i in obj)obj.hasOwnProperty(i)&&parts.push(encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return parts.join("&")}var fbAppId,loginCallback,loginProcessed,FB_LOGIN_URL="https://www.facebook.com/dialog/oauth",FB_LOGOUT_URL="https://www.facebook.com/logout.php",APP_BASE_URL="https://beta.phonegap.trippics.com",tokenStore=window.sessionStorage,context=window.location.pathname.substring(0,window.location.pathname.indexOf("/",2)),oauthRedirectURL=(location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+context,APP_BASE_URL+"/oauthcallback.html"),logoutRedirectURL=APP_BASE_URL+"/logoutcallback.html";return console.log(oauthRedirectURL),console.log(logoutRedirectURL),{init:init,login:login,logout:logout,revokePermissions:revokePermissions,api:api,oauthCallback:oauthCallback,getLoginStatus:getLoginStatus}}();