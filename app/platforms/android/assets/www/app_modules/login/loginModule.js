!function(){"use strict";angular.module("tp.login",["tp.user","tp.facebook"]).controller("LoginCtrl",function($scope,LoginService,UserService,FacebookService){$scope.loginWithFacebook=function(){$scope.user="searching...",LoginService.loginWithFacebook().then(function(userData){$scope.user=userData.first_name+" "+userData.last_name})},$scope.loginWithEmail=function(){$scope.user="searching...",LoginService.loginWithEmail($scope.form.username,$scope.form.password).then(function(response){UserService.setUser(response),$scope.user=UserService.getUser().first_name+" "+UserService.getUser().last_name,console.log(UserService.getUser())})},$scope.revokePermissions=function(){FacebookService.revokePermissions()},$scope.logoutWithFacebook=function(){FacebookService.logout()}}).controller("LoginForgotPasswordCtrl",function(){}).factory("LoginService",function($http,$q,FacebookService){return{loginWithEmail:function(localUsername,localPassword){var deferred=$q.defer();return $http({method:"POST",url:FacebookService.getAppBaseURL()+"/api/login/",data:{username:localUsername,password:localPassword}}).success(function(response){deferred.resolve(response)}),deferred.promise},loginWithFacebook:function(){var deferred=$q.defer();return FacebookService.init(),FacebookService.login().then(function(){FacebookService.getInfo().then(function(userData){console.log("userData"),console.log(userData),deferred.resolve(userData)}),FacebookService.getTimestamp().then(function(){console.log(FacebookService.getAuth().token),console.log(FacebookService.getAuth().expires),$http({method:"POST",url:FacebookService.getAppBaseURL()+"/api/login/facebook/",data:{access_token:FacebookService.getAuth().token,expires:FacebookService.getAuth().expires}}).success(function(response){console.log("FIM"),console.log(response)})})}),deferred.promise}}})}();